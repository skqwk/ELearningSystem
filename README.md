# ELearningSystem


## Описание
В данном репозитории находится приложение системы дистанционного обучения. Данное приложение разработано как часть курсовой работы на 4-ем семестре обучения в РТУ МИРЭА по дисциплине "Шаблоны Программных Платформ Языка Джава"

## Содержание
1. [Описание функциональности](#task0)
2. [Руководство по пользованию](#task1)
3. [Требования к системе](#task2)
4. [Установка и настройка](#task3)

### <a name="task0"></a> 1. Описание функциональности

Приложение использует разделение ролей пользователей:
- сотрудник учебного отдела
- учитель
- ученик

И обладает следующей функциональностью:

**Сотрудник УО**
- может составлять учебный план
- формировать классы
- формировать кафедры
- сопоставлять учителей классам

**Учитель**
- может выполнять проверку домашнего задания
- публиковать учебные материалы

**Ученик**
- может изучать учебные материалы
- выполнять домашние задания


### <a name="task1"></a> 2. Руководство по пользованию



### <a name="task4"></a> 4. Как решить проблему упорядочивания событий?

Как упорядочить события?

1) **Использовать метки времени**
   _Но время на различных устройствах может отличаться и в таком случае метки времени нам не нужны, нам нужен относительный порядок_

2) **Использовать идентификаторы (1, 2, 3...)**
   _Но мы не можем просто использовать идентификаторы, т.к. тогда каждое устройство будет зависеть от глобального идентификаторы и это будет требовать строгой согласованности_

3) **Использовать специальные часы для синхронизации**

Существует много видов часов для синхронизации данных
- Часы Лэмпорта
- Векторные часы
- Гибридные логические часы

Каждые из этих часов основаны на том, что синхронизировать все узлы полностью невозможно, и поэтому множество событий рассматривается как **частично упорядоченное множество**.

Особый интерес из всех описанных часов вызывают гибридные логические часы (Hybrid Logical Clock), которые лишены недостатков остальных:
- В отличие от часов Лэмпорта гибридные логические часы близки к физическому времени
- В отличие от векторных часов их размер не зависит от количества узлов

#### Гибридные логические часы (HLC)

Данные часы существуют на каждом устройстве и тот факт, что они не являются централизованными, позволяет избежать ограничения строгой согласованности.

HLC генерируют метки времени, которые можно назначить каждому событию.

![timestamp](asset/timestamp.png)

Каждая метка времени, генерируемая HLC состоит из нескольких частей. Первая часть поддерживает максимально близкое значение к текущему системному времени, а вторая часть представляет собой логическую компоненту, используемую для сбора причинно-следственной связи в том случае, если первая часть временных меток совпала.

HLC позволяют нам по метке времени сравнить изменения и сказать произошло ли одно изменение раньше другого, т.е. благодаря данным часам мы можем восстановить относительный порядок.

### <a name="task5"></a> 5. Как решить конфликты?

До данного момента мы обсуждали проблемы, связанные с упорядочиванием, однако даже если события корректно упорядочены не исключена возможность возникновения конфликтов, когда, например, два пользователя в офлайне вносят изменения в один и тот же фрагмент, а после производят синхронизацию.

Существует несколько способов:

1) **Ручное разрешение конфликтов**. _Все ответственность за разрешение переносится на пользователя или разработчика. Данный подход крайне сложен в реализации, поскольку существует множество случаев, которые надо обработать._

2) **Использование бесконфликтно-реплицированных типов данных (CRDT)**


**Бесконфликтно-реплицированный тип данных (CRDT)** — это структура данных, упрощающая распределенные системы хранения данных и многопользовательские приложения.


Основными примерами реализации CRDT являются:

- G-Counter
- PN-Counter
- G-Set (Grow-only Set)
- LWW-Element-Set (Last-Write-Wins)
- OR-Set

CRDT имеет 2 главных свойства:

- **Коммутативность** (порядок не имеет значения)
- **Идемпотентность** (повторность не меняет состояния)

Таким образом, для CRDT не важно, в каком порядке и сколько раз вы применяете изменения - по своему определению CRDT гарантирует, что состояние на различных устройствах будет идентичным.

### <a name="task6"></a> 6. Пример приложения

В качестве примера, я разработал приложение, которое использует в своей основе бесконфликтно-реплицированный тип данных, а именно - реализация _LWW-Map_ с применением _G-Set_ на основе базы данных SQLite.

![table](asset/table.png)

Ключами в _LWW-Map_ выступают гибридные метки времени, которые генерируются при каждом изменении и используются для упорядочивания. LWW-Map означает, что наибольший вес имеют изменения сделанные позже.

В отличие от обычной базы данных, для реализации CRDT необходимо отказаться от операции удаления - в этом заключается суть G-Set (Grow-Only Set). Мы назначаем специальную колонку, в которой помечаем удаленные строки, чтобы при распространении изменений на остальные устройства сообщить, что данные строки удалены.

https://github.com/skqwk/CRDT/blob/b9e2a4884592def74978e146bbe53e5d94774ae0/src/main/java/shared/crdt/sqldriver/MessageDriver.java#L59-L69

В основе приложения клиент-серверная архитектура - все клиенты общаются через сервер и у каждого клиента есть собственная база данных с сохраняемыми сообщениями. При синхронизации, клиенты отсылают друг другу сообщения и дальше обрабатывают получение.

https://github.com/skqwk/CRDT/blob/b9e2a4884592def74978e146bbe53e5d94774ae0/src/main/java/shared/crdt/sqldriver/MessageDriver.java#L344-L358

Пример использования

![example](asset/example.gif)